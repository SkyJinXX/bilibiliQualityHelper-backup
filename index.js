// ==UserScript==
// @name         2020!非解析!BiliBili清晰度破解
// @supportURL   https://bbs.blueagle.top/d/3
// @homepage     https://bbs.blueagle.top/d/3
// @icon         data:image/jpeg;base64,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
// @namespace    https://www.bilibili.com/*
// @version      0.0.6
// @description  2020!非解析!BiliBili破解最高清晰度(只能最高的清晰度像4K,1080P+,1080P60等),自动切换最高清晰度
// @author       Blueagle
// @match        *://www.bilibili.com/*
// @match        *://xbeibeix.com/api/bilibili*
// @require      http://cdn.staticfile.org/jquery/2.0.0/jquery.min.js
// ==/UserScript==
var config_crack = {
    //全局配置
    auto_highest_quality: true, //是否自动切换最高清晰度
    beibei_password: "2020102601", //请在这里输入群公告的密码
};
if (location.toString().indexOf("www.bilibili.com") <= -1) {
    if (self != top) {
        document.cookie =
            "beibeibili_config_password=" +
            config_crack.beibei_password +
            "; expires=Thu, 18 Dec 2999 12:00:00 GMT; path=/api/bilibili";

            console.warn('document.cookie', document.cookie)
    }
    window.onload = function () {

        if (self != top) {
            window.addEventListener(
                "message",
                function (a) {
                    window.get_url = a.data;
                },
                false
            );
            console.warn($("input[name*='bilibiliurl']").val())
            if ($("input[name*='bilibiliurl']").val().length > 0) {
                function get_quality() {
                    console.log($("#listhd").children("option[selected]").text(), 'ddd', $("#listhd").children("option").first().text())
                    console.log($("#listhd"))
                    if (
                        $("#listhd").children("option[selected]").text() ===
                        $("#listhd").children("option").first().text()
                    ) {
                        switch (
                            $("#listhd").children("option[selected]").text()
                        ) {
                            case " 超清 4K ◀ ":
                                return "4K";
                                break;
                            case " 高清 1080P+ ◀ ":
                                return "1080P+";
                                break;
                            case " 高清 720P60 ◀ ":
                                return "720P60";
                                break;
                            case " 高清 1080P60 ◀ ":
                                return "1080P60";
                                break;
                            case " 高清 1080P ◀ ":
                                return "1080P";
                                break;
                            case " 高清 720P ◀ ":
                                return "720P";
                                break;
                        }
                    } else {
                        return "password_error";
                    }
                }
                if (get_quality() === "password_error") {
                    parent.postMessage(get_quality(), "*");
                } else {
                    if (
                        $("#list")
                            .children("option:contains('M4S')")
                            .next()
                            .text()
                            .indexOf("音频") != -1
                    ) {
                        parent.postMessage("分段视频", "*");
                    } else {
                        var b = {
                            quality: get_quality(),
                            m4s_video: decrypt($("#list")
                                .children("option:contains('M4S')")
                                .next()
                                .val()),
                            m4s_audio: decrypt($("#list")
                                .children("option:contains('音频')")
                                .next()
                                .val()),
                        };
                        parent.postMessage(JSON.stringify(b), "*");
                    }
                }
            } else {
                var c = setInterval(function () {
                    if (
                        $("input[name*='bilibiliurl']").length > 0 &&
                        $("#button-1").length > 0
                    ) {
                        $("input[name*='bilibiliurl']").val(window.get_url);
                        $("#button-1").click();
                        parent.postMessage("refresh", "*");
                        clearInterval(c);
                    }
                }, 10);
            }
            $("video").bind("play", function () {
                $("video").pause();
            });
        }
    };
} else {
    window.get_vip_course = function () {
        $(".bui-select-list").prepend(
            "<li class='bui-select-item' id='crack_statue'><span class='bilibili-player-video-quality-text'>破解状态</span><span>请等待</span></li>"
        );
        $("body").append(
            "<iframe id='beibei' src='https://xbeibeix.com/api/bilibili/' style='display:none'></iframe>"
        );
        document.getElementById("beibei").onload = function () {
            if (
                window.location.href.indexOf("video") != -1 ||
                window.location.href.indexOf("bangumi") != -1
            ) {
                window.qmj = window.location.href;
            } else {
                if (typeof __INITIAL_STATE__.bvid === "undefined") {
                    window.qmj = __INITIAL_STATE__.epInfo.bvid;
                } else {
                    window.qmj = __INITIAL_STATE__.bvid;
                }
            }
            document
                .getElementById("beibei")
                .contentWindow.postMessage(
                    window.qmj,
                    "https://xbeibeix.com/api/bilibili/"
                );
            window.addEventListener(
                "message",
                function (d) {
                    if (
                        d.data === "refresh" ||
                        d.data === "password_error" ||
                        d.data === "分段视频"
                    ) {
                        console.log(d)
                        switch (d.data) {
                            case "refresh":
                                document.getElementById(
                                    "beibei"
                                ).onload = function () {
                                    document
                                        .getElementById("beibei")
                                        .contentWindow.postMessage(
                                            window.qmj,
                                            "https://xbeibeix.com/api/bilibili/"
                                        );
                                };
                                break;
                            case "password_error":
                                $("#crack_statue").remove();
                                $(".bui-select-list").prepend(
                                    "<a href='https://bbs.blueagle.top/d/3' style='color:red' class='bui-select-item'>密码错误前往论坛</a>"
                                );
                                // $("#beibei").remove();
                                break;
                            case "分段视频":
                                $("#crack_statue")
                                    .children()
                                    .eq(1)
                                    .text("暂不支持分段视频不过你可以登录观看");
                                $("#beibei").remove();
                                break;
                        }
                    } else {
                        console.warn(d)
                        if (typeof d.data !== 'string') return
                        var e = JSON.parse(d.data);
                        window.beibei_url_quality = e.quality;
                        window.beibei_url_video = e.m4s_video;
                        window.beibei_url_audio = e.m4s_audio;
                        $("#beibei").remove();
                        $(".bui-select-list")
                            .find(
                                "span:contains(" +
                                    window.beibei_url_quality +
                                    ")"
                            )
                            .parents("li")
                            .removeAttr("data-value")
                            .attr("crack_option", "true");
                        if (
                            $(".bui-select-list")
                                .find(
                                    "span:contains(" +
                                        window.beibei_url_quality +
                                        ")"
                                )
                                .siblings(".bilibili-player-bigvip").length > 0
                        ) {
                            $(".bui-select-list")
                                .find(
                                    "span:contains(" +
                                        window.beibei_url_quality +
                                        ")"
                                )
                                .siblings(".bilibili-player-bigvip")
                                .text("已破解");
                        } else {
                            $(".bui-select-list")
                                .find(
                                    "span:contains(" +
                                        window.beibei_url_quality +
                                        ")"
                                )
                                .siblings(".bilibili-player-needlogin")
                                .text("已破解");
                        }
                        var f = setTimeout(function () {
                            $("#crack_statue")
                                .children()
                                .eq(1)
                                .text("该视频无法破解");
                            clearInterval(g);
                        }, 1000);
                        var g = setInterval(function () {
                            if ($("li[crack_option='true']").length > 0) {
                                $("#crack_statue")
                                    .children()
                                    .eq(1)
                                    .text("已破解");
                                clearTimeout(f);
                                clearInterval(g);
                            }
                        }, 100);
                        window.origin_video = "none";
                        $("li[crack_option='true']").click(function () {
                            if (window.origin_video === "none") {
                                $(".bui-select-result").html(
                                    "<span class='bui-select-result'>" +
                                        $(".bui-select-list")
                                            .children("li[crack_option='true']")
                                            .children(
                                                ".bilibili-player-video-quality-text"
                                            )
                                            .text() +
                                        "<span class='bilibili-player-auto-hidden'>(" +
                                        $(".bui-select-list")
                                            .children("li[crack_option='true']")
                                            .children(
                                                ".bilibili-player-video-quality-text"
                                            )
                                            .text() +
                                        ")</span></span>"
                                );
                                $(".bui-select-item-active").removeClass(
                                    "bui-select-item-active"
                                );
                                $(".bui-select-list")
                                    .find(
                                        "span:contains(" +
                                            window.beibei_url_quality +
                                            ")"
                                    )
                                    .parents("li")
                                    .addClass("bui-select-item-active");
                                window.origin_video = $(
                                    ".bilibili-player-video"
                                )
                                    .children("video")
                                    .attr("src");
                                var a = $(".bilibili-player-video").children(
                                    "video"
                                )[0].currentTime;
                                var b = $(".bilibili-player-video").children(
                                    "video"
                                )[0].volume;
                                var c = $(".bilibili-player-video").children(
                                    "video"
                                )[0].playbackRate;
                                $(".bilibili-player-video")
                                    .children("video")
                                    .attr("src", window.beibei_url_video);
                                $(".bilibili-player-video").children(
                                    "video"
                                )[0].currentTime = a;
                                $(".bilibili-player-video").children(
                                    "video"
                                )[0].volume = b;
                                $(".bilibili-player-video").children(
                                    "video"
                                )[0].playbackRate = c;
                                $("body").append(
                                    "<video id='crack_audio' src='" +
                                        window.beibei_url_audio +
                                        "' style='display:none'></video>"
                                );
                                $(".bilibili-player-video")
                                    .children("video")
                                    .bind("playing", function () {
                                        $("#crack_audio").trigger("play");
                                        $("#crack_audio")[0].currentTime = $(
                                            this
                                        )[0].currentTime;
                                    });
                                $(".bilibili-player-video")
                                    .children("video")
                                    .bind("pause", function () {
                                        $("#crack_audio").trigger("pause");
                                    });
                                $(".bilibili-player-video")
                                    .children("video")
                                    .bind("load", function () {
                                        $("#crack_audio").trigger("load");
                                    });
                                $(".bilibili-player-video")
                                    .children("video")
                                    .bind("seeking", function () {
                                        $("#crack_audio")[0].currentTime = $(
                                            this
                                        )[0].currentTime;
                                    });
                                $(".bilibili-player-video")
                                    .children("video")
                                    .bind("volumechange", function () {
                                        $("#crack_audio")[0].volume = $(
                                            this
                                        )[0].volume;
                                    });
                                $(".bilibili-player-video")
                                    .children("video")
                                    .bind("ratechange", function () {
                                        $("#crack_audio")[0].playbackRate = $(
                                            this
                                        )[0].playbackRate;
                                    });
                                $(".bilibili-player-video")
                                    .children("video")
                                    .bind("waiting", function () {
                                        $("#crack_audio").trigger("pause");
                                    });
                                $(".bilibili-player-video")
                                    .children("video")
                                    .trigger("play");
                            }
                        });
                        $(".bui-select-list")
                            .children("li[crack_option!='true']")
                            .click(function () {
                                if (window.origin_video !== "none") {
                                    $(".bilibili-player-video")
                                        .children("video")
                                        .attr("src", window.origin_video);
                                    $("#crack_audio").remove();
                                    var a = $(".bui-select-list").children()
                                        .length;
                                    var b = setInterval(function () {
                                        if (
                                            a !=
                                            $(".bui-select-list").children()
                                                .length
                                        ) {
                                            $(".bui-select-list").prepend(
                                                "<li class='bui-select-item' id='crack_statue' onclick='location.reload()'><span class='bilibili-player-video-quality-text'>如需重新破解</span><span>请刷新</span></li>"
                                            );
                                            clearInterval(b);
                                        }
                                    }, 10);
                                }
                            });
                        if (config_crack.auto_highest_quality === true) {
                            $("li[crack_option='true']").click();
                        }
                    }
                },
                false
            );
        };
    };
    window.onload = function () {
        function funcUrlDel(a) {
            var b = window.location;
            var c = b.origin + b.pathname + "?";
            var d = b.search.substr(1);
            if (d.indexOf(a) > -1) {
                var e = {};
                var f = d.split("&");
                for (var i = 0; i < f.length; i++) {
                    f[i] = f[i].split("=");
                    e[f[i][0]] = f[i][1];
                }
                delete e[a];
                var g =
                    c +
                    JSON.stringify(e)
                        .replace(/[\"\{\}]/g, "")
                        .replace(/\:/g, "=")
                        .replace(/\,/g, "&");
                return g;
            }
        }
        window.apx = funcUrlDel("spm_id_from");
        switch (window.apx) {
            case "https://www.bilibili.com/":
                break;
            default:
                if (
                    window.location.href.search("play") != -1 ||
                    window.location.href.search("video") != -1 ||
                    window.location.href.search("ep") != -1
                ) {
                    var h = setInterval(function () {
                        if (
                            $(".bui-select-list").find(
                                ".bilibili-player-bigvip"
                            ).length > 0
                        ) {
                            window.get_vip_course();
                            clearInterval(h);
                        }
                        if (
                            $(".bui-select-list").find(
                                ".bilibili-player-needlogin"
                            ).length > 0
                        ) {
                            if (__INITIAL_STATE__.user.isLogin === false) {
                                window.get_vip_course();
                            }
                            clearInterval(h);
                        }
                    }, 10);
                    $(".list-box,.router-link-active,.video-page-card").click(
                        function () {
                            setTimeout(function () {
                                location.reload();
                            }, 10);
                        }
                    );
                    $(".rec-footer").click(function () {
                        var a = $(".video-page-card").length;
                        var b = setInterval(function () {
                            if ($(".video-page-card").length > a) {
                                $(".video-page-card").click(function () {
                                    setTimeout(function () {
                                        location.reload();
                                    }, 10);
                                });
                                clearInterval(b);
                            }
                        }, 10);
                    });
                    $(".bilibili-player-video")
                        .children("video")
                        .bind("ended", function () {
                            var a = setInterval(function () {
                                if (
                                    $(
                                        ".bilibili-player-ending-panel-box-recommend"
                                    ).length > 0
                                ) {
                                    $(
                                        ".bilibili-player-ending-panel-box-recommend"
                                    ).click(function () {
                                        setTimeout(function () {
                                            location.reload();
                                        }, 10);
                                    });
                                    clearInterval(a);
                                }
                            }, 10);
                        });
                }
                break;
        }
    };
}
